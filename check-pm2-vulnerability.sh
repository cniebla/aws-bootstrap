#!/bin/bash

# Script to check for pm2 updates and vulnerability status
echo "Checking pm2 version and vulnerability status..."

# Get current pm2 version
CURRENT_VERSION=$(npm list pm2 | grep pm2 | cut -d'@' -f2)
echo "Current pm2 version: $CURRENT_VERSION"

# Check for latest available version
LATEST_VERSION=$(npm view pm2 version)
echo "Latest pm2 version available: $LATEST_VERSION"

# Run npm audit to check vulnerability status
echo "Running npm audit..."
npm audit

# Compare versions
if [ "$CURRENT_VERSION" != "$LATEST_VERSION" ]; then
  echo "⚠️  A newer version of pm2 is available. Consider updating."
else
  echo "✅ You are running the latest version of pm2."
fi

echo "Check https://github.com/advisories/GHSA-x5gf-qvw8-r2rm for updates on the vulnerability fix."